<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ department }} - {{ _('department_dashboard') }}</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background-color: #f8f9fa; font-family: "Segoe UI", sans-serif; }
    .fade-in { animation: fadeInUp 0.8s ease both; }
    @keyframes fadeInUp { 0% { opacity:0; transform: translateY(20px);} 100% {opacity:1; transform: translateY(0);} }
    .card-hover:hover { box-shadow: 0 6px 20px rgba(0,0,0,0.15); transition: all 0.3s ease-in-out; }
    .badge-status-pending { background-color: #dc3545; color: #fff; }
    .badge-status-inprogress { background-color: #0dcaf0; color: #000; }
    .badge-status-resolved { background-color: #198754; color: #fff; }
  </style>
</head>

<body class="bg-light">

  <!-- Header -->
  <header class="p-3 d-flex justify-content-between align-items-center"
          style="background: linear-gradient(to right, #ff9933, #ffffff, #138808);">
    <div class="d-flex align-items-center gap-3">
      <img src="{{ url_for('static', filename='images/narendra_modi.jpg') }}" style="height:60px;">
      <div>
        <h1 class="h4 mb-0 text-dark">Nagarik Connect</h1>
        <small class="text-muted">{{ _('integrated_citizen_grievance_redressal') }}</small>
      </div>
    </div>

    <nav class="d-flex gap-2">
      <a href="{{ url_for('user_dashboard') }}" class="btn btn-secondary btn-sm">â¬… {{ _('back_to_user') }}</a>
      <a href="{{ url_for('logout') }}" class="btn btn-danger btn-sm">ğŸšª {{ _('logout') }}</a>
    </nav>
  </header>

  <div class="container my-4 fade-in">

    <!-- Department Header -->
    <h2 class="mb-3 text-center">{{ department }} â€” {{ _('department_dashboard') }}</h2>
    <p class="text-center text-muted">
      {{ _('managing_department_message') }} {{ department.lower() }}.
    </p>

    <!-- Worker Info Card -->
    <div class="card shadow-sm mb-4 border-success card-hover">
      <div class="card-body">
        <h5 class="card-title text-success">ğŸ‘· {{ _('workers_assigned') }}</h5>

        {% if worker_info.name and worker_info.name != '-' %}
          <p><strong>{{ worker_info.name }}</strong> - {{ worker_info.contact }}</p>
        {% else %}
          <p>{{ _('no_workers_assigned') }}</p>
        {% endif %}
      </div>
    </div>

    <!-- Stats -->
    <div class="row g-3 mb-4 text-center">
      <div class="col-md-3"><div class="card p-2 shadow-sm"><h6>{{ _('total') }}</h6><p class="display-6">{{ total }}</p></div></div>
      <div class="col-md-3"><div class="card p-2 shadow-sm"><h6>{{ _('pending') }}</h6><p class="display-6 text-danger">{{ pending }}</p></div></div>
      <div class="col-md-3"><div class="card p-2 shadow-sm"><h6>{{ _('in_progress') }}</h6><p class="display-6 text-info">{{ in_progress }}</p></div></div>
      <div class="col-md-3"><div class="card p-2 shadow-sm"><h6>{{ _('resolved') }}</h6><p class="display-6 text-success">{{ resolved }}</p></div></div>
    </div>

    <!-- Table -->
    <h4 class="mb-3">{{ _('complaints_assigned_to') }} {{ department }}</h4>

    <div class="table-responsive">
      <table class="table table-bordered table-hover shadow-sm bg-white align-middle">
        <thead class="table-dark text-center">
          <tr>
            <th>{{ _('id') }}</th>
            <th>{{ _('user') }}</th>
            <th>{{ _('title') }}</th>
            <th>{{ _('description') }}</th>
            <th>{{ _('department') }}</th>
            <th>{{ _('user_image') }}</th>
            <th>{{ _('status') }}</th>
            <th>{{ _('assigned_worker') }}</th>
            <th>{{ _('location') }}</th>
            <th>{{ _('created_at') }}</th>
          </tr>
        </thead>

        <tbody class="text-center">
          {% for c in complaints %}
          <tr>
            <td>{{ c.id }}</td>
            <td>{{ c.user_name }}</td>
            <td>{{ c.title }}</td>
            <td>{{ c.description }}</td>
            <td>{{ c.department }}</td>

            <td>
              {% if c.image %}
                <img src="{{ url_for('static', filename='uploads/' ~ c.image) }}" width="70" class="img-thumbnail">
              {% else %}-{% endif %}
            </td>

            <td>
              {% if c.status == 'Pending' %}
                <span class="badge badge-status-pending">{{ _('pending') }}</span>
              {% elif c.status == 'In Progress' %}
                <span class="badge badge-status-inprogress">{{ _('in_progress') }}</span>
              {% else %}
                <span class="badge badge-status-resolved">{{ _('resolved') }}</span>
              {% endif %}
            </td>

            <td>
              {% if c.assigned_worker_name %}
                <strong>{{ c.assigned_worker_name }}</strong><br>
                <small>{{ c.assigned_worker_phone }}</small>
              {% else %}
                -
              {% endif %}
            </td>

            <td>
              {% if c.latitude and c.longitude %}
                <a href="https://google.com/maps?q={{ c.latitude }},{{ c.longitude }}" target="_blank" class="btn btn-sm btn-link">
                  ğŸ“ {{ _('view_exact_location') }}
                </a>
              {% elif c.location %} {{ c.location }}
              {% else %}-{% endif %}
            </td>

            <td>{{ c.created_at }}</td>

          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>

  <!-- Footer -->
  <footer class="bg-dark text-white text-center py-3 mt-4">
    Â© 2025 Nagarik Connect | {{ _('government_of_india_initiative') }}
  </footer>

</body>
</html>
