<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ _('admin_feedback_dashboard') }} - Nagarik Connect</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <style>
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 12px;
      height: 12px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
      border: 2px solid #f1f5f9;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
    }

    ::-webkit-scrollbar-corner {
      background: #f1f5f9;
    }

    /* Firefox Scrollbar */
    html {
      scrollbar-width: thin;
      scrollbar-color: #667eea #f1f5f9;
    }
  </style>
</head>

<body class="bg-light">
<header class="p-3 d-flex justify-content-between align-items-center"
        style="background: linear-gradient(to right, #ff9933, #ffffff, #138808);">
  <h4>{{ _('admin_feedback_dashboard') }}</h4>
  <a href="{{ url_for('admin_dashboard') }}" class="btn btn-dark">{{ _('back_to_dashboard') }}</a>
</header>

<div class="container my-4">

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <h2>{{ _('feedback_analytics') }}</h2>
  {% if analytics %}
  <div class="row g-3 text-center mb-4">
    <div class="col-md-2"><div class="card p-2"><h6>{{ _('avg_rating') }}</h6><p class="h4">{{ analytics.avg_rating or '0' }}</p></div></div>
    <div class="col-md-2"><div class="card p-2"><h6>{{ _('total_feedbacks') }}</h6><p class="h4">{{ analytics.total_feedback }}</p></div></div>
    <div class="col-md-2"><div class="card p-2"><h6>⭐5</h6><p class="h4">{{ analytics.five_star }}</p></div></div>
    <div class="col-md-2"><div class="card p-2"><h6>⭐4</h6><p class="h4">{{ analytics.four_star }}</p></div></div>
    <div class="col-md-2"><div class="card p-2"><h6>⭐3</h6><p class="h4">{{ analytics.three_star }}</p></div></div>
    <div class="col-md-2"><div class="card p-2"><h6>⭐2/1</h6><p class="h4">{{ analytics.two_star + analytics.one_star }}</p></div></div>
  </div>
  {% endif %}

  <h3>{{ _('all_feedbacks') }}</h3>
  <div class="table-responsive">
    <table class="table table-bordered bg-white align-middle">
      <thead class="table-dark text-center">
        <tr>
          <th>ID</th>
          <th>{{ _('user') }}</th>
          <th>{{ _('title') }}</th>
          <th>{{ _('message') }}</th>
          <th>{{ _('complaint') }}</th>
          <th>{{ _('rating') }}</th>
          <th>{{ _('admin_reply') }}</th>
          <th>{{ _('action') }}</th>
        </tr>
      </thead>
      <tbody class="text-center">
        {% for f in feedbacks %}
        <tr>
          <td>{{ f.id }}</td>
          <td>{{ f.user_name }}</td>
          <td>{{ f.title }}</td>
          <td>{{ f.message }}</td>
          <td>{{ f.complaint_title or _('general_feedback') }}</td>
          <td>{{ f.rating }}⭐</td>
          <td>{{ f.admin_reply or '-' }}</td>
          <td>
            <form method="POST" class="d-flex gap-2">
              <input type="hidden" name="feedback_id" value="{{ f.id }}">
              <textarea name="reply" class="form-control form-control-sm" placeholder="{{ _('enter_reply') }}"></textarea>
              <button class="btn btn-primary btn-sm">{{ _('reply') }}</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<footer class="bg-dark text-white text-center py-3 mt-4">
  © 2025 Nagarik Connect | {{ _('feedback_admin_portal') }}
</footer>
</body>
</html>
